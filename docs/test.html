<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Orbit Kamera um Modell â€“ AR.js</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; touch-action: none; }
  </style>
</head>
<body>

<a-scene
  vr-mode-ui="enabled: false"
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
>
  <!-- Kamera-Rig rotiert um das Modell -->
  <a-entity id="cameraRig" position="0 1.0 0" rotation="0 0 0">
    <a-entity camera position="0 0 3"></a-entity>
  </a-entity>

  <!-- Modell bleibt fix -->
  <a-entity
    id="model"
    gltf-model="test.gltf"
    position="0 0 0"
    scale="1 1 1"
    rotation="0 0 0"
  ></a-entity>
</a-scene>

<script>
  const cameraRig = document.getElementById('cameraRig');

  let isTouching = false;
  let lastTouch = null;
  let startRotation = { x: 0, y: 0 };

  document.body.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
      isTouching = true;
      lastTouch = { x: e.touches[0].clientX, y: e.touches[0].clientY };
      const rot = cameraRig.getAttribute('rotation');
      startRotation = { x: rot.x, y: rot.y };
    }
  });

  document.body.addEventListener('touchmove', (e) => {
    if (isTouching && e.touches.length === 1) {
      const deltaX = e.touches[0].clientX - lastTouch.x;
      const deltaY = e.touches[0].clientY - lastTouch.y;

      let newRotY = startRotation.y - deltaX * 0.3; // Horizontal orbit
      let newRotX = startRotation.x - deltaY * 0.3; // Vertical orbit

      // Begrenzung nach oben/unten (nicht unter Boden schauen)
      newRotX = Math.max(-30, Math.min(60, newRotX));

      cameraRig.setAttribute('rotation', `${newRotX} ${newRotY} 0`);
    }
  });

  document.body.addEventListener('touchend', () => {
    isTouching = false;
    lastTouch = null;
  });
</script>

</body>
</html>
