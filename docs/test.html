<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR.js Modell mit Pinch & Swipe</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; touch-action: none; }
    </style>
  </head>
  <body>
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-entity camera></a-entity>

      <a-entity
        id="model"
        gltf-model="test.gltf"
        position="0 0 -2"
        scale="1 1 1"
        rotation="0 0 0"
      ></a-entity>
    </a-scene>

    <script>
      const model = document.getElementById('model');

      let lastTouchDist = null;
      let lastRotationX = null;
      let startRotY = 0;

      document.body.addEventListener('touchstart', (e) => {
        if (e.touches.length === 2) {
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          lastTouchDist = Math.sqrt(dx * dx + dy * dy);
        } else if (e.touches.length === 1) {
          lastRotationX = e.touches[0].clientX;
          // Speichere aktuelle Y-Rotation
          startRotY = model.getAttribute('rotation').y;
        }
      });

      document.body.addEventListener('touchmove', (e) => {
        if (e.touches.length === 2 && lastTouchDist !== null) {
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          const newDist = Math.sqrt(dx * dx + dy * dy);
          const scale = Math.min(Math.max(newDist / lastTouchDist, 0.5), 5);

          model.setAttribute('scale', `${scale} ${scale} ${scale}`);
        } else if (e.touches.length === 1 && lastRotationX !== null) {
          const deltaX = e.touches[0].clientX - lastRotationX;
          const newRotY = startRotY + deltaX * 0.5; // Drehgeschwindigkeit
          model.setAttribute('rotation', `0 ${newRotY} 0`);
        }
      });

      document.body.addEventListener('touchend', (e) => {
        if (e.touches.length < 2) lastTouchDist = null;
        if (e.touches.length === 0) lastRotationX = null;
      });
    </script>
  </body>
</html>
