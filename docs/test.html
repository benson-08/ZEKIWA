<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR.js mit test.gltf</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; touch-action: none; }
    </style>
  </head>
  <body>
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <!-- Kamera leicht nach unten geneigt -->
      <a-entity camera rotation="20 0 0"></a-entity>

      <!-- Modell leicht unterhalb des Sichtfelds, 2m entfernt -->
      <a-entity
        id="model"
        gltf-model="test.gltf"
        position="0 -1.2 -2"
        scale="1 1 1"
        rotation="0 0 0"
      ></a-entity>
    </a-scene>

    <script>
      const model = document.getElementById('model');

      let lastTouchDist = null;
      let lastTouchPos = null;
      let startRot = { x: 0, y: 0 };

      document.body.addEventListener('touchstart', (e) => {
        if (e.touches.length === 2) {
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          lastTouchDist = Math.sqrt(dx * dx + dy * dy);
        } else if (e.touches.length === 1) {
          lastTouchPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
          const r = model.getAttribute('rotation');
          startRot = { x: r.x, y: r.y };
        }
      });

      document.body.addEventListener('touchmove', (e) => {
        if (e.touches.length === 2 && lastTouchDist !== null) {
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          const newDist = Math.sqrt(dx * dx + dy * dy);
          const scale = Math.min(Math.max(newDist / lastTouchDist, 0.3), 5);
          model.setAttribute('scale', `${scale} ${scale} ${scale}`);
        } else if (e.touches.length === 1 && lastTouchPos !== null) {
          const deltaX = e.touches[0].clientX - lastTouchPos.x;
          const deltaY = e.touches[0].clientY - lastTouchPos.y;
          const newRotY = startRot.y + deltaX * 0.4;
          const newRotX = startRot.x + deltaY * 0.4;
          model.setAttribute('rotation', `${newRotX} ${newRotY} 0`);
        }
      });

      document.body.addEventListener('touchend', (e) => {
        if (e.touches.length < 2) lastTouchDist = null;
        if (e.touches.length === 0) lastTouchPos = null;
      });
    </script>
  </body>
</html>
